{
  "comments": [
    {
      "key": {
        "uuid": "15fbac3f_03d3ee51",
        "filename": "buildSrc/src/main/kotlin/androidx/build/dependencyTracker/AffectedModuleDetector.kt",
        "patchSetId": 6
      },
      "lineNbr": 295,
      "author": {
        "id": 1137668
      },
      "writtenOn": "2019-03-26T16:49:43Z",
      "side": 1,
      "message": "Using a filter means that if there exists an entry in COBUILT_TEST_NAMES for which there doesn\u0027t exist a matching project, then it won\u0027t fail (so it won\u0027t be as obvious to the user if they mistype the project name or if they rename it).\n\nI imagine it being easy enough to replace this function with something more like:\n\nfun lookupProjectSetsFromNames(allSets: Set\u003cSet\u003cString\u003e\u003e): Set\u003cSet\u003cProject\u003e\u003e {\n    return allSets.map( setNames -\u003e {\n        // given a set of project names, make a set of the projects that it corresponds to\n        setNames.map({ name -\u003e\n            rootProject.getProject(name)\n        })\n    })\n}",
      "range": {
        "startLine": 295,
        "startChar": 40,
        "endLine": 295,
        "endChar": 46
      },
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e8ce912_63f1321c",
        "filename": "buildSrc/src/main/kotlin/androidx/build/dependencyTracker/AffectedModuleDetector.kt",
        "patchSetId": 6
      },
      "lineNbr": 295,
      "author": {
        "id": 1442661
      },
      "writtenOn": "2019-03-26T19:06:42Z",
      "side": 1,
      "message": "I think this might be WAI. \n\nI don\u0027t know if anybody is going to be manually typing in project names in. As far as I know, nobody actually uses the AffectedModuleDetector so much as it gets invoked. \n\nAs to renaming a project, this would cause the team\u0027s co-dependent tests not to be built, and thus to fail. I would rather have their tests failing and have them file a bug against us than have presubmits failing for all presubmit runs, and have a p0 to deal blocking all teams. \n\nAs for using something like getProject(name) instead of matching against name, the closest is Project.project(path). But that would mean another refactor back to path, and if we stick with filter I don\u0027t see a lot of benefit worth the headache. \n\nThis is currently only for media team, just trying to get their presubmits unblocked so they can stop bypassing them on all their runs. If it turns out to have additional use cases beyond this, I\u0027m happy to reevaluate.",
      "parentUuid": "15fbac3f_03d3ee51",
      "range": {
        "startLine": 295,
        "startChar": 40,
        "endLine": 295,
        "endChar": 46
      },
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ad8ed90b_a24d7a64",
        "filename": "buildSrc/src/main/kotlin/androidx/build/dependencyTracker/AffectedModuleDetector.kt",
        "patchSetId": 6
      },
      "lineNbr": 295,
      "author": {
        "id": 1137668
      },
      "writtenOn": "2019-03-26T20:06:26Z",
      "side": 1,
      "message": "Do you mean that it\u0027s preferred that if an entry in COBUILT_TEST_NAMES doesn\u0027t correspond to a project that it gets ignored?\nI\u0027d expect that it\u0027d be easy for a developer to remove the unneeded entry and that we might as well throw an error to remind them as soon as they make the change rather than later when the tests fail.\nI think that would more closely align with the name of the method, too (\"lookup...\").\n\nYeah, I\u0027m not expecting developers to be typing project names into the command line, just maybe one or two of us to be editing the contents of COBUILT_TEST_NAMES in this file every once in a while.\n\nIf it were a nontrivial transformation to rewrite this function to do a lookup of the individual projects, then yeah, it would seem reasonable to me to leave it as it is.\nYou should be able to just copy-paste the code I typed and fix any mistakes I made (you mention that getProject should be replaced with Project.project(path)).\n\nI\u0027m less concerned about this particular error actually causing a problem in practice, and more interested in the general process of decreasing the cost of defensive coding and/or refactoring via practicing them more.",
      "parentUuid": "5e8ce912_63f1321c",
      "range": {
        "startLine": 295,
        "startChar": 40,
        "endLine": 295,
        "endChar": 46
      },
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51630fe5_204be704",
        "filename": "buildSrc/src/main/kotlin/androidx/build/dependencyTracker/AffectedModuleDetector.kt",
        "patchSetId": 6
      },
      "lineNbr": 295,
      "author": {
        "id": 1137668
      },
      "writtenOn": "2019-03-26T20:23:46Z",
      "side": 1,
      "message": "Also of note, the function Project.project(path) refers to a logical Gradle path (the ones that are separated by the \":\" character) rather than a filesystem filepath. \nSo in this particular case (because these media projects aren\u0027t nested inside other projects according to settings.gradle (unlike, for example, :lifecycle:lifecycle-common)), refactoring the contents of COBUILT_TEST_NAMES from name back to path really just means adding \":\" to the front of each entry",
      "parentUuid": "ad8ed90b_a24d7a64",
      "range": {
        "startLine": 295,
        "startChar": 40,
        "endLine": 295,
        "endChar": 46
      },
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9885a5ed_281bbd4c",
        "filename": "buildSrc/src/main/kotlin/androidx/build/dependencyTracker/AffectedModuleDetector.kt",
        "patchSetId": 6
      },
      "lineNbr": 295,
      "author": {
        "id": 1442661
      },
      "writtenOn": "2019-03-27T15:38:30Z",
      "side": 1,
      "message": "Sorry, I was feeling the pressure of getting this bug fixed, and let that cloud my judgment. I\u0027ve made the refactor.",
      "parentUuid": "51630fe5_204be704",
      "range": {
        "startLine": 295,
        "startChar": 40,
        "endLine": 295,
        "endChar": 46
      },
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b727f81a_e685de0d",
        "filename": "buildSrc/src/test/kotlin/androidx/build/dependencyTracker/AffectedModuleDetectorImplTest.kt",
        "patchSetId": 6
      },
      "lineNbr": 135,
      "author": {
        "id": 1137668
      },
      "writtenOn": "2019-03-26T20:06:26Z",
      "side": 1,
      "message": "I also imagine adding a few more test projects here too, and/or making the cobuilt test names into a parameter that tests can modify",
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08408a60_4570ffef",
        "filename": "buildSrc/src/test/kotlin/androidx/build/dependencyTracker/AffectedModuleDetectorImplTest.kt",
        "patchSetId": 6
      },
      "lineNbr": 135,
      "author": {
        "id": 1442661
      },
      "writtenOn": "2019-03-27T15:38:30Z",
      "side": 1,
      "message": "It was necessary to add 4 more tests projects here, to ensure that they were found upon lookup. If we add more to the cobuilt sets, I imagine we will want to refactor to use a parameter.\n\nIf you\u0027d prefer it refactored sooner than that, could I ask that we push this through to unblock the bug, and I\u0027ll open a separate bug against myself to refactor it first thing when I\u0027m back from London? I\u0027m finding that I have a couple higher priorities that I\u0027d rather spend that time on tomorrow (foremost of which is preparing for a talk I\u0027m giving here), but also feel guilty about not having this unblocked for media team yet.",
      "parentUuid": "b727f81a_e685de0d",
      "revId": "3ba508602c27921ccfa5e098d4793c16028e820a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}