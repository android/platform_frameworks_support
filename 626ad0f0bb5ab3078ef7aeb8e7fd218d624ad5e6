{
  "comments": [
    {
      "key": {
        "uuid": "c76f8501_4ad97308",
        "filename": "webkit/src/androidTest/java/androidx/webkit/TracingControllerTest.java",
        "patchSetId": 11
      },
      "lineNbr": 221,
      "author": {
        "id": 1141809
      },
      "writtenOn": "2018-10-22T22:01:46Z",
      "side": 1,
      "message": "I don\u0027t think this is correct. Docs [1] say \"should only be called on the UI thread,\" not that this automatically posts on the UI thread.\n\nCan you replace this with InstrumentationRegistry.getInstrumentation().runOnMainSync (ex. [2])?\n\n[1] http://cs/android/frameworks/base/core/java/android/annotation/UiThread.java?l\u003d30\u0026rcl\u003d23bab6c7668ced8d94089e664975ac6888a3e220\n[2] http://cs/android/frameworks/support/webkit/src/androidTest/java/androidx/webkit/WebViewOnUiThread.java?l\u003d310\u0026rcl\u003d3d68de4fbf64aa1df1c694e6ca180f6a5297291a",
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "40f5619c_284748b9",
        "filename": "webkit/src/androidTest/java/androidx/webkit/TracingControllerTest.java",
        "patchSetId": 11
      },
      "lineNbr": 221,
      "author": {
        "id": 1370549
      },
      "writtenOn": "2018-10-25T18:29:44Z",
      "side": 1,
      "message": "Is the main thread the same as UI thread?\n\nIt seems the tests are already running on the Main thread since I\u0027m getting a\njava.lang.RuntimeException: This method can not be called from the main application thread\nwhen call runOnMainSync.",
      "parentUuid": "c76f8501_4ad97308",
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c86f34f6_49a29837",
        "filename": "webkit/src/androidTest/java/androidx/webkit/TracingControllerTest.java",
        "patchSetId": 11
      },
      "lineNbr": 221,
      "author": {
        "id": 1141809
      },
      "writtenOn": "2018-10-25T19:40:31Z",
      "side": 1,
      "message": "I\u0027ll take a look today.",
      "parentUuid": "40f5619c_284748b9",
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19f1b791_05c0ce18",
        "filename": "webkit/src/androidTest/java/androidx/webkit/TracingControllerTest.java",
        "patchSetId": 11
      },
      "lineNbr": 221,
      "author": {
        "id": 1141809
      },
      "writtenOn": "2018-10-27T03:14:56Z",
      "side": 1,
      "message": "\u003e Is the main thread the same as UI thread?\n\nYes.\n\n\u003e It seems the tests are already running on the Main thread\n\nThis is not the case. You can verify this by adding Log.w() statements. These will print the pid and tid to the left of the message. The \"main\" thread\u0027s tid is equal to the process pid. You\u0027ll see Log.w() shows a background tid when called from a test (expected) and shows a main thread tid when called within runOnMainSync().\n\n\u003e This method can not be called from the main application thread\n\nThis is because runTracingTestWithCallbacks calls mWebViewOnUiThread.loadUrlAndWaitForCompletion. In AndroidX, this calls runOnMainSync [1] (and it\u0027s invalid to call runOnMainSync when already on the main thread). On the other hand, this method is implemented differently in CTS [2].\n\nSo, you ran runTracingTestWithCallbacks on UI thread (correct) but that attempted to run loadUrl() on UI thread (hence the error message).\n\nI think we can change the AndroidX WebViewOnUiThread to follow the CTS version. Can you update callAndWait() to check if `Looper.myLooper() \u003d\u003d Looper.getMainLooper()`? If so, just immediately run the runnable.\n\n[1] http://cs/android/frameworks/support/webkit/src/androidTest/java/androidx/webkit/WebViewOnUiThread.java?l\u003d403\u0026rcl\u003d03a5ab2e9bf6349afb794902483a716874dde40b\n[2] http://cs/android/cts/libs/deviceutillegacy/src/android/webkit/cts/WebViewOnUiThread.java?l\u003d881\u0026rcl\u003d559a87e474f96d8827eea7a1a2610a756964ad33",
      "parentUuid": "c86f34f6_49a29837",
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f3790f2_a70925f2",
        "filename": "webkit/src/androidTest/java/androidx/webkit/TracingControllerTest.java",
        "patchSetId": 11
      },
      "lineNbr": 221,
      "author": {
        "id": 1370549
      },
      "writtenOn": "2018-11-05T15:32:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "19f1b791_05c0ce18",
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0d31e518_02430f1a",
        "filename": "webkit/src/main/java/androidx/webkit/TracingConfig.java",
        "patchSetId": 11
      },
      "lineNbr": 172,
      "author": {
        "id": 1141809
      },
      "writtenOn": "2018-10-22T22:01:46Z",
      "side": 1,
      "message": "Why do we need \"\u003ccode\u003e\" here? Does \u003cpre\u003e not escape special javadoc characters?",
      "range": {
        "startLine": 172,
        "startChar": 9,
        "endLine": 172,
        "endChar": 14
      },
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9305751e_ed78760a",
        "filename": "webkit/src/main/java/androidx/webkit/TracingConfig.java",
        "patchSetId": 11
      },
      "lineNbr": 172,
      "author": {
        "id": 1370549
      },
      "writtenOn": "2018-10-25T18:29:44Z",
      "side": 1,
      "message": "My guess is to handle line breaks. \n\nIt has been written this way in the original TracingConfig. (https://cs.corp.google.com/aosp-pie/frameworks/base/core/java/android/webkit/TracingConfig.java?q\u003dTracingConfig.java\u0026dr\u0026l\u003d159)",
      "parentUuid": "0d31e518_02430f1a",
      "range": {
        "startLine": 172,
        "startChar": 9,
        "endLine": 172,
        "endChar": 14
      },
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dad1cb63_5925f29f",
        "filename": "webkit/src/main/java/androidx/webkit/TracingConfig.java",
        "patchSetId": 11
      },
      "lineNbr": 172,
      "author": {
        "id": 1141809
      },
      "writtenOn": "2018-10-25T19:40:31Z",
      "side": 1,
      "message": "Ok",
      "parentUuid": "9305751e_ed78760a",
      "range": {
        "startLine": 172,
        "startChar": 9,
        "endLine": 172,
        "endChar": 14
      },
      "revId": "626ad0f0bb5ab3078ef7aeb8e7fd218d624ad5e6",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}